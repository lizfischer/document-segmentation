{% extends "base.html" %}

{% block content %}
    <a href="{{ url_for('main') }}"><< Change project</a>
    <h1>{{ project.name }}</h1>

    <ul>
        <li><a href="{{ url_for('split_file', project_id=project.id) }}"> Split pages </a></li>
        <li><a href="#" id="binarize"> Binarize </a></li>
        <li><a href="#" id="margins"> Margins </a></li>
        <li><a href="{{ url_for('simple_separate_ui', project_id=project.id) }}"> Simple Separate </a></li>
        <li><a href="{{ url_for('export', project_id=project.id) }}"> Export Entries </a></li>
        <li><a href="{{ url_for('export_txt', project_id=project.id) }}"> Download ZIP of entries as plaintext </a></li>
        <li><a href="{{ url_for('cleanup', project_id=project.id) }}"> Remove unnecessary project files </a></li>

    </ul>
    <div id="progress"></div>
    <table id="tasks"></table>
    {% block module %}        {% endblock %}

    <script type="text/javascript">
         $(function() {
            $('#binarize').click(function (){ start_long_task("binarize", {{project.id}}, callback=finished_binarize) });
            $('#margins').click(function (){ start_long_task("thresholds", {{project.id}}, data=null, callback=finished_margins) });

        });

         function finished_binarize(data){
             console.log("Binarize: " + data["status"]);
         }

         function finished_margins(data){
            console.log("Finished preparing margins");
            const start = data["preview"]["start"];
            const end = data["preview"]["end"];
            const url = `/{{project.id}}/threshold-preview?t=${data["thresh_id"]}&start=${start}&end=${end}`;
            window.location.href = url;
         }

    </script>

{% endblock %}